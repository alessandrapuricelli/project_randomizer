// TOPIC
const art_a = [
  { name: 'a_1', text_info: '1', images_link: 'a' },
  { name: 'a_2', text_info: '2', images_link: 'b' },
  { name: 'a_3', text_info: '3', images_link: 'c' },
  { name: 'a_4', text_info: '4', images_link: 'd' },
  { name: 'a_5', text_info: '5', images_link: 'e' },
  { name: 'a_6', text_info: '6', images_link: 'f' },
  { name: 'a_7', text_info: '7', images_link: 'g' },
  { name: 'a_8', text_info: '8', images_link: 'h' },
  { name: 'a_9', text_info: '9', images_link: 'i' },
  { name: 'a_10', text_info: '10', images_link: 'g' },
]
const art_b = [
  { name: 'b_1', text_info: '1', images_link: 'a' },
  { name: 'b_2', text_info: '2', images_link: 'b' },
  { name: 'b_3', text_info: '3', images_link: 'c' },
  { name: 'b_4', text_info: '4', images_link: 'd' },
  { name: 'b_5', text_info: '5', images_link: 'e' },
  { name: 'b_6', text_info: '6', images_link: 'f' },
  { name: 'b_7', text_info: '7', images_link: 'g' },
  { name: 'b_8', text_info: '8', images_link: 'h' },
  { name: 'b_9', text_info: '9', images_link: 'i' },
  { name: 'b_10', text_info: '10', images_link: 'g' },
]
const fashion_a = [
  { name: 'a_1', text_info: '1', images_link: 'a' },
  { name: 'a_2', text_info: '2', images_link: 'b' },
  { name: 'a_3', text_info: '3', images_link: 'c' },
  { name: 'a_4', text_info: '4', images_link: 'd' },
  { name: 'a_5', text_info: '5', images_link: 'e' },
  { name: 'a_6', text_info: '6', images_link: 'f' },
  { name: 'a_7', text_info: '7', images_link: 'g' },
  { name: 'a_8', text_info: '8', images_link: 'h' },
  { name: 'a_9', text_info: '9', images_link: 'i' },
  { name: 'a_10', text_info: '10', images_link: 'g' },
]
const fashion_b = [
  { name: 'b_1', text_info: '1', images_link: 'a' },
  { name: 'b_2', text_info: '2', images_link: 'b' },
  { name: 'b_3', text_info: '3', images_link: 'c' },
  { name: 'b_4', text_info: '4', images_link: 'd' },
  { name: 'b_5', text_info: '5', images_link: 'e' },
  { name: 'b_6', text_info: '6', images_link: 'f' },
  { name: 'b_7', text_info: '7', images_link: 'g' },
  { name: 'b_8', text_info: '8', images_link: 'h' },
  { name: 'b_9', text_info: '9', images_link: 'i' },
  { name: 'b_10', text_info: '10', images_link: 'g' },
]
const music_a = [
  { name: 'a_1', text_info: '1', images_link: 'a' },
  { name: 'a_2', text_info: '2', images_link: 'b' },
  { name: 'a_3', text_info: '3', images_link: 'c' },
  { name: 'a_4', text_info: '4', images_link: 'd' },
  { name: 'a_5', text_info: '5', images_link: 'e' },
  { name: 'a_6', text_info: '6', images_link: 'f' },
  { name: 'a_7', text_info: '7', images_link: 'g' },
  { name: 'a_8', text_info: '8', images_link: 'h' },
  { name: 'a_9', text_info: '9', images_link: 'i' },
  { name: 'a_10', text_info: '10', images_link: 'g' },
]
const music_b = [
  { name: 'b_1', text_info: '1', images_link: 'a' },
  { name: 'b_2', text_info: '2', images_link: 'b' },
  { name: 'b_3', text_info: '3', images_link: 'c' },
  { name: 'b_4', text_info: '4', images_link: 'd' },
  { name: 'b_5', text_info: '5', images_link: 'e' },
  { name: 'b_6', text_info: '6', images_link: 'f' },
  { name: 'b_7', text_info: '7', images_link: 'g' },
  { name: 'b_8', text_info: '8', images_link: 'h' },
  { name: 'b_9', text_info: '9', images_link: 'i' },
  { name: 'b_10', text_info: '10', images_link: 'g' },
];

const topic = [art_a, art_b, fashion_a, fashion_b, music_a, music_b];

// COLORS
const mono = ['B / W'];
const duotone = ['B / W + col1', 'B / W + col2', 'B / W + col3', 'B / W + col4', 'B / W + col5', 'B / W + col6', 'B / W + col7', 'B / W + col8'];
const tritone = ['B / W + col1 + col1', 'B / W + col2 + col2', 'B / W + col3 + col3', 'B / W + col4 + col4', 'B / W + col5 + col5', 'B / W + col6 + col6', 'B / W + col7 + col7', 'B / W + col8 + col8'];

const colors = [mono, duotone, tritone];

// TYPOS
const serif = ['serif1', 'serif2', 'serif3', 'serif4', 'serif5', 'serif6'];
const sans_serif = ['sans_serif1', 'sans_serif2', 'sans_serif3', 'sans_serif4', 'sans_serif5', 'sans_serif6'];
const crazy = ['crazy1', 'crazy2', 'crazy3', 'crazy4', 'crazy5', 'crazy6'];

const typo = [serif, sans_serif, crazy];

const settings = { topic, colors, typo }

const settings_order = ['time', 'style', 'tools', 'colors', 'typo', 'topic', 'recap', 'links']

let settings_counter = 0;

console.log(settings);


let level;
let points;
// // initialize the menu
function init() {
  // get the level
  level = get_level();
  const level_btns = document.getElementsByClassName('btns')[0].children;
  for (const el of level_btns) {
    const attribute = el.getAttribute('class');
    console.log(attribute, el.dataset.level);
    if (el.dataset.level === level) {
      el.setAttribute('class', attribute + ' dark');
    } else {
      el.setAttribute('class', attribute + ' lighten');
    }
  }

}

init();


function go_to_settings(el) {
  // first hide the level menu
  $('.level').hide('fast', () => {
    next_settings();
    // show the rest of the footer
    const footer = document.getElementsByClassName('hidden-footer')
    for (const el of footer) {
      el.style.visibility = 'visible'
    }
    const level = el.dataset.level
    // set the level as cookie. we will need it later on the next page
    set_cookie(cookie_names.level, level, 365);
    set_timers(level);
  })
}

function next_settings() {

  if (settings_counter === 0) {
    // first hide the level menu
    $('.level').hide('fast');
    // hide the random button
    $('#random').hide('fast');

    set_timers(level);
  }
  // remove the older
  if (settings_counter > 0) {

    // remove older setting
    document.getElementById(settings_order[settings_counter - 1]).style.visibility = 'collapse';
  }

  // show the new setting
  const id = settings_order[settings_counter];
  const setting = document.getElementById(id);
  setting.style.visibility = 'visible';

  if (id === 'recap') {
    // get all the settings

    get_settings();
  }

  // when we reach the last setting we change the next button to start
  if (settings_counter >= settings_order.length - 1) {
    const next_btn = document.getElementById('next');
    next_btn.innerHTML = '<a href="../randomizer/index.html">START!</a>';
  }

  settings_counter++;
}



function random(){
  randomize_settings();
  settings_counter = 6;
  if (settings_counter === 6) {
    // first hide the level menu
    $('.level').hide('fast');
    // hide the random button
    $('#random').hide('fast');

    set_timers(level);
  }
  next_settings();
}

// function set_initial_settings() {
//   console.log('set random settings');
//   const ids = ['topic', 'colors', 'typo'];
//   for (const id of ids) {
//     const setting = document.getElementById(id).children;
//     // console.log(setting);
//     let idx = 0;
//     for (const item of setting) {
//       // console.log(item);
//       const label = $(item).find('label.radio');
//       // console.log(label);
//       if (label.length > 0) {
//         const txt = get_random_element_from_array(settings[id][idx]);
//         // console.log(txt);
//         $(label).text(txt);
//         idx++;
//         if (idx > 2) break;
//       }
//     }
//   }
// }

const beginner = [35, 40, 45];
const intermediate = [20, 25, 30];
const expert = [5, 10, 15];
const timings = { beginner, intermediate, expert }

function set_timers(level) {
  const timers = document.getElementById('time').children
  switch (level) {
    case 'beginner':
      console.log(`I'm a beginner`);
      assign_time(timings[level]);
      break;
    case 'intermediate':
      console.log(`I'm a intermediate`);
      assign_time(timings[level]);
      break;
    case 'expert':
      assign_time(timings[level]);
      console.log(`I'm an expert`);
      break;
    default:
      console.log('something went wrong you got assigned beginner!');
      assign_time(timings['beginner']);
      break;

  }

  function assign_time(arr) {
    const minutes = ' "';//cambia questo per cambiare cosa viene scritto dopo i minuti
    let idx = 0
    for (const child of timers) {
      const label = $(child).find('label.radio');
      if (label.length > 0) {
        label.text(arr[idx] + minutes);
        label.val(arr[idx])
        idx++;
      }
    }
  }
}

function set_setting(arr) {
  const rnd_idx = Math.floor(Math.random() * arr.length);
  const btn = arr[rnd_idx];
  $(btn)[0].control.checked = 'true';
}



const ids = [
  'topic',
  'tools',
  'colors',
  'typo',
  'style',
  'time'
]

function randomize_settings() {

  for (const id of ids) {
    const children = document.getElementById(id).children;
    const inputs = $(children).find('label.radio');

    const input = get_random_element_from_array(inputs);

    input.control.checked = true;
  }
}

randomize_settings()

function get_settings() {
  const result = {};
  for (const id of ids) {
    const children = document.getElementById(id).children;
    const inputs = $(children).find('label.radio');

    for (const input of inputs) {
      if (input.control.checked === true) {
        result[id] = input.dataset.setting;
        if (id === 'time') result[id] = input.value;
      }
    }
  }
  // set the combination settings
  switch (result['topic']) {
    case 'art':
      result['topic'] = { art: [get_random_element_from_array(art_a), get_random_element_from_array(art_b)] };
      break;
    case 'music':
      result['topic'] = { music: [get_random_element_from_array(music_a), get_random_element_from_array(music_b)] };
      break;
    case 'fashion':
      result['topic'] = { fashion: [get_random_element_from_array(fashion_a), get_random_element_from_array(fashion_b)] };
      break;
  }

  switch (result['typo']) {
    case 'serif':
      result['typo'] = get_random_element_from_array(serif);
      break;
    case 'sans-serif':
      result['typo'] = get_random_element_from_array(sans_serif);
      break;
    case 'surprise':
      result['typo'] = get_random_element_from_array(crazy);
      break;
  }

  switch (result['colors']) {
    case 'b/w':
      result['colors'] = get_random_element_from_array(mono);
      break;
    case 'similar colors':
      result['colors'] = get_random_element_from_array(duotone);
      break;
    case 'different colors':
      result['colors'] = get_random_element_from_array(tritone);
      break;
  }

  console.log(result);

  generate_recap(result);

  generate_links(result['topic']);

  // const json = JSON.stringify(result);
  // console.log(result);
  // set_cookie(cookie_names.settings, json, 365);
  write_settings_cookie(result);
  // now we should write them to a cookie to be read in the next page

}

function generate_recap(settings) {
  const parent = document.getElementById('recap');


  Object.keys(settings).forEach(key => {
    let setting = settings[key];
    const setting_name = key;
    if (setting_name === 'topic') {
      console.log(setting);
      const topic_name = Object.keys(setting)[0];
      console.log(setting[topic_name][0]);
      setting = topic_name + ': ' + setting[topic_name][0].name + ' + ' + setting[topic_name][1].name;
    }

    // draw the recap title
    const recap_title = document.createElement('div');
    recap_title.setAttribute('class', 'info-text dark center-item');
    recap_title.innerText = setting_name;
    parent.appendChild(recap_title)

    // draw the recap content
    const recap_content = document.createElement('div');
    recap_content.setAttribute('class', 'info-text center-item');
    recap_content.innerText = setting;
    parent.appendChild(recap_content);
  })

  const level = get_cookie(cookie_names.level);
  const level_btn = document.createElement('div');
  level_btn.setAttribute('class', 'info-text dark center-item');
  level_btn.innerText = level;
  parent.appendChild(level_btn);

}

function generate_links(topic) {

  const link_a = document.getElementById('links-a');
  const link_b = document.getElementById('links-b');

  const topic_name = Object.keys(topic)[0];
  console.log(topic_name, topic[topic_name]);
  const topic_a = topic[topic_name][0];
  const topic_b = topic[topic_name][1];
  let idx = 0;
  for (const el of topic[topic_name]) {
    const topic_head = document.createElement('h3')
    topic_head.innerText = el.name + '\ntext content:';
    if (idx === 0) link_a.appendChild(topic_head);
    else link_b.appendChild(topic_head);

    const topic_txt = document.createElement('p');
    topic_txt.innerText = el.text_info;
    if (idx === 0) link_a.appendChild(topic_txt);
    else link_b.appendChild(topic_txt);


    const links_head = document.createElement('h3')
    links_head.innerText = 'images links:';
    if (idx === 0) link_a.appendChild(links_head);
    else link_b.appendChild(links_head);

    const links_txt = document.createElement('p');
    links_txt.innerText = el.images_link;
    if (idx === 0) link_a.appendChild(links_txt);
    else link_b.appendChild(links_txt);

    idx++;
  }
}

function fill_array(string, item_num) {
  const result = []
  for (let i = 0; i < item_num; i++)result.push(string + i);
  return result
}

function get_random_element_from_array(arr) {
  const rnd_idx = Math.floor(Math.random() * arr.length);
  return arr[rnd_idx];
}
